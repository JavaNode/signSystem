# 联盟杯内训师大赛管理系统 - 部署指南

## 🚀 快速部署

### 环境要求
- Python 3.8+ 
- Node.js 16.0+
- 现代浏览器 (Chrome 80+, Firefox 75+, Safari 13+)

### 一键启动

**Windows系统:**
```bash
# 双击运行
start.bat

# 或在命令行执行
.\start.bat
```

**Linux/Mac系统:**
```bash
# 给脚本执行权限
chmod +x start.sh

# 运行启动脚本
./start.sh
```

## 📋 手动部署步骤

### 1. 后端部署

```bash
# 进入后端目录
cd backend

# 安装Python依赖
pip install -r requirements.txt

# 启动后端服务
python simple_app.py
```

后端服务将在 http://localhost:8000 启动

### 2. 前端部署

```bash
# 进入前端目录
cd frontend

# 安装Node.js依赖
npm install

# 启动开发服务器
npm run dev
```

前端服务将在 http://localhost:3000 启动

### 3. 验证部署

运行测试脚本验证系统是否正常工作：

```bash
python test_system.py
```

## 🔧 配置说明

### 后端配置

**端口配置:**
- 默认端口: 8000
- 修改位置: `backend/simple_app.py` 最后一行

**数据库配置:**
- 数据文件: `data/simple_data.json`
- 自动创建示例数据

**CORS配置:**
- 默认允许所有来源
- 生产环境建议限制来源

### 前端配置

**端口配置:**
- 默认端口: 3000
- 修改位置: `frontend/vite.config.ts`

**API地址配置:**
- 默认地址: http://localhost:8000
- 修改位置: `frontend/src/api/index.ts`

**代理配置:**
- 开发环境自动代理 `/api` 到后端
- 生产环境需要配置Nginx等反向代理

## 🌐 生产环境部署

### 后端生产部署

```bash
# 使用Gunicorn部署
pip install gunicorn
gunicorn -w 4 -k uvicorn.workers.UvicornWorker app.main:app --bind 0.0.0.0:8000

# 或使用Docker
docker build -t sign-system-backend .
docker run -p 8000:8000 sign-system-backend
```

### 前端生产部署

```bash
# 构建生产版本
npm run build

# 使用Nginx部署
# 将dist目录内容复制到Nginx网站根目录
cp -r dist/* /var/www/html/

# 配置Nginx反向代理
# 在nginx.conf中添加:
location /api {
    proxy_pass http://localhost:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

### Docker部署

创建 `docker-compose.yml`:

```yaml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
  
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
```

运行:
```bash
docker-compose up -d
```

## 🔒 安全配置

### 后端安全

1. **修改默认密码**
   - 管理员密码: `backend/simple_app.py` 中的 `valid_passwords`
   - 评委密码: 同上

2. **启用HTTPS**
   ```bash
   # 使用SSL证书
   uvicorn app.main:app --host 0.0.0.0 --port 8000 --ssl-keyfile key.pem --ssl-certfile cert.pem
   ```

3. **限制CORS来源**
   ```python
   # 在simple_app.py中修改
   app.add_middleware(
       CORSMiddleware,
       allow_origins=["https://yourdomain.com"],  # 限制来源
       allow_credentials=True,
       allow_methods=["GET", "POST"],
       allow_headers=["*"],
   )
   ```

### 前端安全

1. **配置CSP头**
   ```html
   <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
   ```

2. **HTTPS重定向**
   ```javascript
   if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
       location.replace('https:' + window.location.href.substring(window.location.protocol.length));
   }
   ```

## 📊 性能优化

### 后端优化

1. **使用缓存**
   ```python
   # 安装Redis
   pip install redis
   
   # 缓存统计数据
   import redis
   r = redis.Redis(host='localhost', port=6379, db=0)
   ```

2. **数据库优化**
   - 使用PostgreSQL替代SQLite
   - 添加数据库索引
   - 实现连接池

### 前端优化

1. **代码分割**
   ```javascript
   // 路由懒加载已配置
   component: () => import('./views/AdminDashboard.vue')
   ```

2. **资源压缩**
   ```bash
   # 构建时自动压缩
   npm run build
   ```

3. **CDN加速**
   ```html
   <!-- 使用CDN加载Element Plus -->
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
   ```

## 🔍 故障排除

### 常见问题

1. **端口被占用**
   ```bash
   # Windows查看端口占用
   netstat -ano | findstr :8000
   
   # Linux/Mac查看端口占用
   lsof -i :8000
   
   # 杀死进程
   taskkill /PID <PID> /F  # Windows
   kill -9 <PID>           # Linux/Mac
   ```

2. **依赖安装失败**
   ```bash
   # 清理缓存重新安装
   pip cache purge
   pip install -r requirements.txt --no-cache-dir
   
   # 或使用国内镜像
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
   ```

3. **跨域问题**
   - 检查后端CORS配置
   - 确认前端API地址正确
   - 使用代理或配置Nginx

4. **数据库连接失败**
   - 检查数据目录权限
   - 确认SQLite文件路径
   - 查看错误日志

### 日志查看

**后端日志:**
```bash
# 启动时查看详细日志
python simple_app.py --log-level debug
```

**前端日志:**
```bash
# 开发者工具Console
# 或查看Network面板API请求
```

## 📞 技术支持

如遇到部署问题，请提供以下信息：

1. 操作系统版本
2. Python/Node.js版本
3. 错误日志截图
4. 网络环境说明

联系方式：
- 📧 邮箱: support@example.com
- 📱 电话: 400-xxx-xxxx
- 💬 微信: xxxxxxxx

---

**祝您部署顺利！** 🎉